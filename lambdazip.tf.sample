terraform {
  required_providers {
    lambdazip = {
      source = "winebarrel/lambdazip"
    }
  }
}

provider "lambdazip" {
}

resource "lambdazip_file" "node_program" {
  base_dir      = "example-app"
  source        = "**"
  excludes      = [".*", "README.md"]
  output        = "my-program.zip"
  before_create = "npm i"

  triggers = {
    for i in [
      "example-app/index.js",
      "example-app/package.json",
      "example-app/package-lock.json",
    ] : i => filesha256(i)
  }
}

output "zip_sha256" {
  value = lambdazip_file.node_program.base64sha256
}
